# ForgeAI — Caddy reverse proxy with automatic HTTPS
# This file is used when running with domain support enabled.
# Set DOMAIN in your .env file to your domain (e.g., ai.example.com)

{$DOMAIN:localhost} {
	# Reverse proxy to the Gateway container
	reverse_proxy localhost:18800

	# Security headers
	header {
		# HSTS — force HTTPS
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		# Prevent clickjacking
		X-Frame-Options "SAMEORIGIN"
		# Prevent MIME sniffing
		X-Content-Type-Options "nosniff"
		# XSS protection
		X-XSS-Protection "1; mode=block"
		# Referrer policy
		Referrer-Policy "strict-origin-when-cross-origin"
		# Remove server header
		-Server
	}

	# WebSocket support (for Companion, real-time updates)
	@websocket {
		header Connection *Upgrade*
		header Upgrade websocket
	}
	reverse_proxy @websocket gateway:18800

	# Increase timeouts for long agent operations
	request_body {
		max_size 50MB
	}

	# Logging
	log {
		output stdout
		format console
	}
}
